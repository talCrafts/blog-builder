<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Elasticsearch on TalCrafts Blog</title>
    <link>http://www.talcrafts.com/tags/elasticsearch/index.xml</link>
    <description>Recent content in Elasticsearch on TalCrafts Blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <atom:link href="http://www.talcrafts.com/tags/elasticsearch/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Elasticsearch Dynamic Mapping</title>
      <link>http://www.talcrafts.com/2017/03/elasticsearch-dynamic-mapping/</link>
      <pubDate>Wed, 22 Mar 2017 20:56:25 +0530</pubDate>
      
      <guid>http://www.talcrafts.com/2017/03/elasticsearch-dynamic-mapping/</guid>
      <description>&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;&lt;strong&gt;Introduction&lt;/strong&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;In Elasticsearch, it is not neccessary to create an index, define mapping before hand and then index a document. For example, We can create a document of type &lt;code&gt;post&lt;/code&gt; in an index called &lt;code&gt;blog&lt;/code&gt; in Elasticseach by just firing following command:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlight&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;PUT blog/post/1
{
  &#34;author&#34;: &#34;Imteyaz&#34;,
  &#34;age&#34;: 30,
  &#34;post_date&#34;: &#34;2017-03-21&#34;,
  &#34;description&#34;: &#34;2017-03-21&#34;
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Elasticsearch automatically detects and add new types and fields. This is called &lt;em&gt;dynamic mapping&lt;/em&gt;. It is a great feature as it helps in getting started fast. However this can be problematic sometimes. Let&amp;#8217;s have a look on the &lt;em&gt;mapping&lt;/em&gt; generated by Elasticsearch for the document.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlight&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;GET blog/_mapping
// Result
{
  &#34;blog&#34;: {
    &#34;mappings&#34;: {
      &#34;post&#34;: {
        &#34;properties&#34;: {
          &#34;age&#34;: {
            &#34;type&#34;: &#34;long&#34;
          },
          &#34;author&#34;: {
            &#34;type&#34;: &#34;text&#34;,
            &#34;fields&#34;: {
              &#34;keyword&#34;: {
                &#34;type&#34;: &#34;keyword&#34;,
                &#34;ignore_above&#34;: 256
              }
            }
          },
          &#34;description&#34;: {
            &#34;type&#34;: &#34;date&#34;
          },
          &#34;post_date&#34;: {
            &#34;type&#34;: &#34;date&#34;
          }
        }
      }
    }
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Here, the type of &lt;code&gt;description&lt;/code&gt; field is &lt;code&gt;date&lt;/code&gt; which is not desired. To prevent such thing, we can either disable &lt;code&gt;date_detection&lt;/code&gt; or we can define a custom dynamic template.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;&lt;strong&gt;Disable Date Detection&lt;/strong&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Dynamic date detection can be disbled by setting &lt;code&gt;date_detection&lt;/code&gt; to &lt;code&gt;false&lt;/code&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlight&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;PUT blog/_mapping/post
{
    &#34;date_detection&#34;: false
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;&lt;strong&gt;Define Custom Template&lt;/strong&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;We can define our own dynamic template and create it as shown below:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlight&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;PUT _template/idx_template
{
    &#34;template&#34;: &#34;blog*&#34;,
    &#34;settings&#34;: {
        &#34;number_of_shards&#34;: 5,
        &#34;number_of_replicas&#34;: 1
    },
    &#34;analysis&#34;: {
        &#34;analyzer&#34;: {
            &#34;mc_analyzer&#34;: {
                &#34;type&#34;: &#34;standard&#34;,
                &#34;stopwords&#34;: &#34;_english_&#34;
            }
        }
    },
    &#34;mappings&#34;: {
        &#34;post&#34;: {
          &#34;date_detection&#34;: false,
            &#34;dynamic_templates&#34;: [{
                &#34;date_fields&#34;: {
                    &#34;match&#34;: &#34;*_date&#34;,
                    &#34;mapping&#34;:{
                        &#34;type&#34;: &#34;date&#34;
                    }
                }

            }]
        }
    }
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This template applies to any index whose name start with &lt;code&gt;blog&lt;/code&gt;. Here we have disabled date detection and explicitely mapping our field as date that contains &lt;code&gt;_date&lt;/code&gt; in it.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now let us create the &lt;code&gt;blog&lt;/code&gt; index again and see the mapping generated.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlight&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;PUT blog/post/1
{
  &#34;author&#34;: &#34;Imteyaz&#34;,
  &#34;age&#34;: 30,
  &#34;post_date&#34;: &#34;2017-03-21&#34;,
  &#34;description&#34;: &#34;2017-03-21&#34;
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Below is the new mapping generated by Elasticsearch:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock json&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;highlight&#34;&gt;&lt;code&gt;{
  &#34;blog&#34;: {
    &#34;mappings&#34;: {
      &#34;post&#34;: {
        &#34;dynamic_templates&#34;: [
          {
            &#34;date_fields&#34;: {
              &#34;match&#34;: &#34;*_date&#34;,
              &#34;mapping&#34;: {
                &#34;type&#34;: &#34;date&#34;
              }
            }
          }
        ],
        &#34;date_detection&#34;: false,
        &#34;properties&#34;: {
          &#34;age&#34;: {
            &#34;type&#34;: &#34;long&#34;
          },
          &#34;author&#34;: {
            &#34;type&#34;: &#34;text&#34;,
            &#34;fields&#34;: {
              &#34;keyword&#34;: {
                &#34;type&#34;: &#34;keyword&#34;,
                &#34;ignore_above&#34;: 256
              }
            }
          },
          &#34;description&#34;: {
            &#34;type&#34;: &#34;text&#34;,
            &#34;fields&#34;: {
              &#34;keyword&#34;: {
                &#34;type&#34;: &#34;keyword&#34;,
                &#34;ignore_above&#34;: 256
              }
            }
          },
          &#34;post_date&#34;: {
            &#34;type&#34;: &#34;date&#34;
          }
        }
      }
    }
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;In the new mapping created, the  &lt;code&gt;description&lt;/code&gt; field is a &lt;code&gt;text&lt;/code&gt; and &lt;code&gt;post_date&lt;/code&gt; is a &lt;code&gt;date&lt;/code&gt; field.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;&lt;strong&gt;Conclusion&lt;/strong&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;It&amp;#8217;s better to create a template for index if we don&amp;#8217;t know new fields to be added in future and if somehow we can control the field name.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;&lt;strong&gt;References&lt;/strong&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-templates.html&#34; class=&#34;bare&#34;&gt;https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-templates.html&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://www.elastic.co/guide/en/elasticsearch/guide/current/index.html&#34; class=&#34;bare&#34;&gt;https://www.elastic.co/guide/en/elasticsearch/guide/current/index.html&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;</description>
    </item>
    
  </channel>
</rss>